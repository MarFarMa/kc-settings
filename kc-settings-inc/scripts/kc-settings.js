var win=window.dialogArguments||opener||parent||top;function inArray(d,c){var b=c.length;for(var a=0;a<b;a++){if(c[a]==d){return true}}return false}function kcsbSlug(a){strNu=a.replace(/^\-+/,"");strNu=strNu.replace(/^_+/,"");strNu=strNu.replace(/[^A-Za-z0-9\-_]/g,"");if(strNu.match(/^\-+/)||strNu.match(/^_+/)){strNu=kcsbSlug(strNu)}return strNu}function invertColor(a){inverted=new RGBColor(a);if(inverted.ok){a="rgb("+(255-inverted.r)+", "+(255-inverted.g)+", "+(255-inverted.b)+")"}return a}(function(a){win.kcsInsertFiles=function(){var e=win.kcSettings.upload.nu.length;if(e){var b=win.kcSettings.upload.id,c=b.children().last(),f=a();while(e){e--;var d=c.clone();a("input",d).each(function(){this.value=win.kcSettings.upload.nu[e][0];a(this).prop("checked",false)});a(".title",d).text(win.kcSettings.upload.nu[e][1]);d.find("img").attr("src",win.kcSettings.upload.nu[e][2]);f=f.add(d)}b.append(f);if(c.is(".hidden")){f.show();c.remove()}b.show().prev(".info").show()}};a.fn.kcGoto=function(b){defaults={offset:-20,speed:800};b=a.extend({},defaults,b);return this.each(function(){var c=a(this);c.fadeIn(function(){a("html, body").stop().animate({scrollTop:(c.offset().top+b.offset)},b.speed)})})};a.fn.kcsbUnique=function(){return this.each(function(){var c=a(this),b=c.val();c.data("olVal",b).blur(function(){var f=a(this),e=c.data("olVal"),d=f.val();if(d!=e&&inArray(d,kcSettings._ids[f.data("ids")])){f.val("")}})})};a.fn.kcsbCheck=function(){var b=a(this);if((b.attr("name")==="kcsb[id]"&&b.val()==="id")||b.val()===""){b.val("").focus().css("borderColor","#ff0000");return false}else{b.removeAttr("style")}};a.fn.kcFormDep=function(b){defaults={disable:true,callback:function(){}};b=a.extend({},defaults,b);return this.each(function(){var d=a(this),e=d.val(),f=(d.data("scope")!==undefined)?d.closest(d.data("scope")).find(d.data("child")):a(d.data("child")),c;if(!f.length){return}f.each(function(){var h=a(this),g=h.data("dep");if((typeof g==="string"&&g===e)||(typeof g==="object"&&inArray(e,g))){c=true}else{c=false}h.toggle(c);if(b.disable===true){h.find(":input").prop("disabled",!c)}})})};a.fn.kcReorder=function(h,d){var g=new RegExp(h+"\\]\\[(\\d+)"),f=new RegExp(h+"\\-(\\d+)"),c=a(this);if(d===true){var e=c.children(),b=0}else{var e=c,b=c.index()}e.each(function(){var i=a(this);i.find(":input").each(function(){this.name=this.name.replace(g,function(k,j){return h+"]["+b});if(this.id!==""){this.id=this.id.replace(f,function(k,j){return h+"-"+b})}});i.find("label").each(function(){var j=a(this),k=j.attr("for");if(k!==""&&k!==undefined){j.attr("for",k.replace(f,function(m,l){return h+"-"+b}))}});b++});return this}})(jQuery);jQuery(document).ready(function(d){var j=d("#kcsb"),e=d("form.kcsb"),a=d("#kc-settings-form").find("div.postbox").find("#kcs-components");if(a.length){var c="#"+a.closest("div.metabox-holder").attr("id")+"-",g=a.find(":checkbox"),h=d();g.each(function(){var l=d(c+this.value);if(!l.length){return}var m=d(this),k=d(c+this.value+"-hide");m.data("sectTarget",k).data("mBox",l);if(!(this.checked===k[0].checked)){k.prop("checked",this.checked).triggerHandler("click")}h=h.add(m)});if(h.length){h.change(function(){var k=d(this);k.data("sectTarget").prop("checked",this.checked).triggerHandler("click");if(this.checked){k.data("mBox").kcGoto({offset:-40,speed:"slow"})}})}}d("ul.kc-rows").sortable({axis:"y",start:function(k,l){l.placeholder.height(l.item.outerHeight())},stop:function(k,l){l.item.parent().kcReorder(l.item.data("mode"),true).children().each(function(){d("> .actions .count",this).text(d(this).index()+1)})}});d(".row a.del").live("click",function(o){var n=d(this),k=n.closest(".row"),l=k.parent(),p=k.data("mode"),m=k.is(":last-child");if(!k.siblings(".row").length){return false}k.addClass("removing").fadeOut("slow",function(){k.remove();if(!m){l.kcReorder(p,true);if(e.length){l.children().each(function(){d("> .actions .count",this).text(d(this).index()+1)})}}});return false});d(".row a.add").live("click",function(p){var q=d(this),s=q.closest(".row"),l=s.parent(),o=s.data("mode"),m=s.is(":last-child"),n=s.clone(false).addClass("adding"),r=false,k=400;if(o=="sections"){r=true;k=1200}else{if(o=="fields"){r=true;k=800}}if(e.length){n.find(".kc-rows").each(function(){var t=d(this).children(".row");if(t.length>1){t.not(":first").remove()}});n.find(":input").each(function(){var t=d(this);if(this.type=="text"||this.type=="textarea"){t.removeAttr("style").val("")}else{if(this.type=="checkbox"||this.type=="radio"){t.prop("checked",this.checked)}}if(t.is(".kcsb-ids")){t.kcsbUnique()}})}else{n.find(":input").each(function(){d(this).val("")})}s.after(n);if(r){n.kcGoto({offset:-100,speed:k})}setTimeout(function(){n.removeClass("adding")},k);l.kcReorder(o,true);if(e.length){if(m){d("> .actions .count",n).text(n.index()+1)}else{l.children().each(function(){d("> .actions .count",this).text(d(this).index()+1)})}}return false});d(".row a.clear").live("click",function(k){d(this).closest(".row").find(":input").val("");return false});var b=d("input[type=date]");if(b.length&&Modernizr.inputtypes.date===false){var f=d("body").is(".admin-color-classic")?"cupertino":"flick";Modernizr.load([{load:win.kcSettings.paths.styles+"/jquery-ui/"+f+"/style.css",complete:function(){b.datepicker({dateFormat:"yy-mm-dd"})}}])}var i=d("input[type=color]");if(i.length&&Modernizr.inputtypes.color===false){Modernizr.load([{load:[win.kcSettings.paths.scripts+"/colorpicker/js/colorpicker.js",win.kcSettings.paths.scripts+"/colorpicker/css/colorpicker.css",win.kcSettings.paths.scripts+"/rgbcolor.js"],complete:function(){i.ColorPicker({onBeforeShow:function(){d(this).ColorPickerSetColor(this.value)},onSubmit:function(k,o,m,n){var l="#"+o;d(n).css({backgroundColor:l,color:invertColor(l)}).val(l).ColorPickerHide()}}).each(function(){var k=d(this);if(k.val()!==""){k.css({backgroundColor:this.value,color:invertColor(this.value)})}})}}])}d(".kcs-file a.rm").live("click",function(m){m.preventDefault();var l=d(this),k=l.closest(".row");k.addClass("removing").fadeOut("slow",function(){if(k.siblings().length){k.remove()}else{k.removeClass("removing").addClass("hidden").find(":input").val("").prop("checked",false);d("input.fileID",k).prop("disabled",true);k.parent().hide().prev(".info").hide()}})});d("a.kcsf-upload").live("click",function(n){n.preventDefault();var l=d(this),m=l.parent(),k=m.find(".row.hidden");win.kcSettings.upload.id=d("#"+m.attr("id")+" > ul");win.kcSettings.upload.files=[];if(k.length){d("input.fileID",k).prop("disabled",false)}else{d("input.include",m).each(function(){win.kcSettings.upload.files.push(this.value)})}tb_show("",l.attr("href"))});d("ul.kc-sortable").sortable({axis:"y",start:function(k,l){l.placeholder.height(l.item.outerHeight())}});d("a.kc-help-trigger").live("click",function(){if(win.kcHelpBox!==undefined){win.kcPopHelp()}else{d("#contextual-help-link").click();d("#screen-meta").kcGoto()}return false});if(j.length){if(!j.is(".hidden")){j.kcGoto()}d(".hasdep",j).live("change",function(){d(this).kcFormDep({disable:true})}).change();d("input.kcsb-slug").live("blur",function(){var l=d(this),k=l.val();l.val(kcsbSlug(k))});d("input.kcsb-ids").kcsbUnique();d("input.required, input.clone-id").live("blur",function(){d(this).kcsbCheck()});d("#new-kcsb").live("click",function(){j.kcGoto();return false});d("a.kcsb-cancel").live("click",function(){d("#kcsb").fadeOut(function(){d("body").kcGoto()});return false});d("a.clone-open").live("click",function(){d(this).parent().children().hide().filter("div.kcsb-clone").fadeIn();return false});d("a.clone-do").click(function(){var k=d(this),l=d(this).siblings("input");if(l.kcsbCheck()===false){return false}k.attr("href",k.attr("href")+"&new="+l.val())});d("input.clone-id").bind("keypress",function(m){var k=m.keyCode||m.which;if(k===13){var l=d(this);m.preventDefault();l.blur().siblings("a.clone-do").data("new",l.val()).trigger("click")}});d(".kcsb-tools a.close").live("click",function(){var l=d(this),k=l.parent();l.siblings("input").val("");k.fadeOut(function(){d(this).siblings().show()});return false});e.submit(function(l){var k=true;d(this).find("input.required").not(":disabled").each(function(){if(d(this).kcsbCheck()===false){k=false;return false}});if(!k){return false}})}});